generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

generator json {
  provider  = "prisma-json-types-generator"
  namespace = "PrismaJson"
}

model Process {
  id      String   @id @default(cuid())
  name    String
  commits Commit[]
}

model Commit {
  id String @id @default(cuid())

  /// [JsonRecord]
  changes  Json
  /// [JsonRecord]
  snapshot Json?

  processId String
  process   Process @relation(fields: [processId], references: [id])

  outgoing Connection[] @relation("SourceCommit")
  incoming Connection[] @relation("TargetCommit")

  createdAt DateTime @default(now())

  @@index([processId])
}

model Connection {
  id           String    @id @default(cuid())
  attributeKey String
  attribute    Attribute @relation(fields: [attributeKey], references: [key])
  fromId       String
  from         Commit    @relation("SourceCommit", fields: [fromId], references: [id])
  toId         String
  to           Commit    @relation("TargetCommit", fields: [toId], references: [id])

  @@index([fromId, attributeKey])
  @@index([toId, attributeKey])
}

model Attribute {
  key         String        @id
  label       String?
  type        AttributeType @default(CUSTOM)
  unit        String?
  options     Json          @default("{}")
  connections Connection[]
}

enum AttributeType {
  LENGTH
  MASS
  TIME
  TEMPERATURE
  PRESSURE
  SPEED
  CURRENCY
  COUNT
  CUSTOM
  DEPENDENCY
  REFERENCE
}
