generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model Process {
  id      String   @id @default(cuid())
  name    String
  commits Commit[]
}

model Commit {
  id String @id @default(cuid())

  changes  Json
  snapshot Json?

  // Consistance
  processId String
  process   Process @relation(fields: [processId], references: [id])

  outgoing Connection[] @relation("SourceCommit")
  incoming Connection[] @relation("TargetCommit")

  // Meta
  authorId  String?
  duration  Int?
  createdAt DateTime @default(now())

  @@index([processId])
}

model Connection {
  id           String              @id @default(cuid())
  attributeKey String
  attribute    AttributeDefinition @relation(fields: [attributeKey], references: [key])
  fromId       String
  from         Commit              @relation("SourceCommit", fields: [fromId], references: [id])
  toId         String
  to           Commit              @relation("TargetCommit", fields: [toId], references: [id])

  @@index([fromId, attributeKey])
  @@index([toId, attributeKey])
}

model AttributeDefinition {
  key         String        @id
  label       String?
  type        AttributeType @default(CUSTOM)
  typeOption  String?
  connections Connection[]
}

enum AttributeType {
  LENGTH
  MASS
  TIME
  TEMPERATURE
  PRESSURE
  SPEED
  CURRENCY
  COUNT
  DEPENDENCY
  REFERENCE
  CUSTOM
}
